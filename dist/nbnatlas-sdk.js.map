{"version":3,"file":"nbnatlas-sdk.js","sources":["../src/util/index.js","../src/config/config.js","../src/config/layers.js","../src/config/species-list.js","../src/services/species-ws.js","../src/validation/error-messages.js","../src/validation/index.js","../src/services/records-ws.js","../src/services/lists-ws.js","../src/core/places.js","../src/core/bbg.js"],"sourcesContent":["/** \n     * @private\n     */\n export async function getJson(url) {\n    const controller = new AbortController();\n    setTimeout(() => controller.abort(), 10000);\n\n    const response = await fetch(url, { signal: controller.signal });\n\n    if (response.status >= 400) {\n        return Promise.reject({\n            status: response.status,\n            message: response.statusText,\n            body: response.data\n        });\n    }\n    if (response.status >= 200 && response.status <= 202) {\n        const json = await response.json();\n        return json;\n    }\n    return {};\n}\n\nexport function encodeAndJoin(items, separator = \" OR \"){\n    let encodedItems= items.map(it => encodeURIComponent('\"' + it + '\"'));\n    return encodedItems.join(\"OR\");\n}","\n/**\n * @private\n */\nexport const CONFIG = {\n    URL_RECORDS_WS: 'https://records-ws.nbnatlas.org',\n    URL_SPECIES_WS: 'https://species-ws-dev.nbnatlas.org',\n    URL_LISTS_WS: 'https://lists.nbnatlas.org'\n}\n","/** \n * Layer ID's\n * @memberof NBNAtlas\n * @property {string} BEAUTIFUL_BURIAL_GROUNDS\n*/\nexport const LAYERS = {\n    BEAUTIFUL_BURIAL_GROUNDS : \"cl273\",\n}\n\n\n/**\n * @typedef {Object}\n * @memberof NBNAtlas\n * @name SpeciesCountByGroup\n * @property {string} speciesGroup - The species group\n * @property {number} speciesCount - The number of species counted\n * @property {number} selectedSpeciesCount - The number of species counted that are of selected interest \n */\n\n/**\n * @typedef {Object}\n * @memberof NBNAtlas\n * @name OccurrenceCount\n * @property {string} scientificName\n * @property {string} commonName\n * @property {string} taxonGuid\n * @property {number} lastRecorded - year of most recent occurrence record, 0 if not known\n * @property {number} count\n * @property {boolean} sensitiveInEngland - true if species is sensitive in England\n * @property {boolean} sensitiveInWales - true if species is sensitive in Wales\n */\n\n/**\n * @typedef {Object}\n * @memberof NBNAtlas\n * @name Place\n * @property {string} id\n * @property {number} name\n */\n\n/**\n * @typedef {Object}\n * @memberof NBNAtlas\n * @name BBGPlace\n * @property {string} assetID\n * @property {number} name\n */","/** \n * Species List ID's\n * @memberof NBNAtlas\n * @property {string} BEAUTIFUL_BURIAL_GROUNDS_SEEK_ADVICE\n * @property {string} BEAUTIFUL_BURIAL_GROUNDS_DIGEST_TABLE\n * @property {string} SENSITIVE_IN_ENGLAND\n * @property {string} SENSITIVE_IN_WALES\n*/\nexport const SPECIES_LIST = {\n    BEAUTIFUL_BURIAL_GROUNDS_SEEK_ADVICE: \"dr2504\",\n    BEAUTIFUL_BURIAL_GROUNDS_DIGEST_TABLE: \"dr2492\",\n    SENSITIVE_IN_ENGLAND: \"dr2058\",\n    SENSITIVE_IN_WALES: \"dr2067\"\n}","import { getJson } from '../util/index.js'\nimport { CONFIG } from '../config/index.js'\n\n/**\n* @private\n*/\nexport class SpeciesWS {\n\n    async getBBGPlace(placeName) {\n        let url = this._buildGetPlaceUrl(placeName);\n        let json = await this._getJson(url);\n        return this._buildBBGPlaceDTO(json);\n    }\n\n\n    async getBBGPlacesForAssetID(assetID) {\n        let url = `${CONFIG.URL_SPECIES_WS}/search?fq=idxtype:REGIONFEATURED&fq=assetid_s:${assetID}`;;\n        let json = await this._getJson(url);\n        return this._buildBBGAssetDTO(json);\n    }\n\n\n\n    /**\n      * @private\n      */\n    _buildBBGPlaceDTO(json) {\n        //let result = json.searchResults?.results?.[0];\n        let result = json.searchResults && json.searchResults.results && json.searchResults.results[0] ?\n            json.searchResults.results[0] : null;\n        return result ? {\n            assetID: result.assetid_s,\n            name: result.bbg_name_s\n        }\n            : [];\n    }\n\n    _buildBBGAssetDTO(json) {\n        //let result = json.searchResults?.results?.[0];\n        let result = json.searchResults && json.searchResults.results && json.searchResults.results.length>0 ?\n            json.searchResults.results : null;\n        return result ? {\n                assetID:result[0].assetid_s,\n                assetName:result[0].name_s,\n                places:result.map(it=>it.bbg_name_s)\n            }\n            : {};\n    }\n\n    /**\n      * @private\n      */\n    _buildGetPlaceUrl(placeName) {\n        return `${CONFIG.URL_SPECIES_WS}/search?fq=idxtype:REGIONFEATURED&fq=name:${encodeURIComponent('\"' + placeName + '\"')}`;\n    }\n\n\n    /** @private */\n    _getJson(url) {\n        return getJson(url)\n    }\n\n}\n\n","\n/**\n * @private\n */\n export const ERROR_MESSAGES = {\n    MISSING_PLACE_NAME: \"Missing place name\",\n    MISSING_SPECIES_LIST_ID: \"Missing species list id\",\n    MISSING_ASSET_ID: \"Missing asset id\",\n}\n","\n/**\n    * @private\n*/\nexport function rejectInvalidRequest(message) {\n    return Promise.reject({\n        status: \"INVALID\",\n        message: message\n    });\n}\n\nexport * from  './error-messages.js'","import { getJson, encodeAndJoin } from '../util/index.js'\nimport { CONFIG } from '../config/index.js'\n\n/**\n* @private\n*/\nexport class RecordsWS {\n\n\n    async getSpeciesCountByGroup({layerId, placeNames}) {\n        let url = `${CONFIG.URL_RECORDS_WS}/explore/groups?q=*:*&fq=${layerId}:(${encodeAndJoin(placeNames)})&fq=-occurrence_status:absent`;\n        let json = await this._getJson(url);\n        return this._buildSpeciesCountByGroupDTO(json);\n    }\n\n    async getSpeciesCountByGroupForSpeciesList({layerId, placeNames, speciesListId}) {\n        let url = `${CONFIG.URL_RECORDS_WS}/explore/groups?q=*:*&fq=${layerId}:(${encodeAndJoin(placeNames)})&fq=-occurrence_status:absent`;\n        url = `${url}&fq=species_list_uid:${speciesListId}`;\n        let json = await this._getJson(url);\n        return this._buildSpeciesCountByGroupDTO(json);\n    }\n\n    async getOccurrenceCount({layerId, placeNames}) {\n        const url = `${CONFIG.URL_RECORDS_WS}/occurrences/search?q=${layerId}:(${encodeAndJoin(placeNames)})&facets=names_and_lsid&pageSize=1&flimit=-1\n                                &fq=-occurrence_status:absent&sort=year&dir=desc&fl=year`;\n        const json = await this._getJson(url);\n        return this._buildOccurrenceCountDTO(json)\n    }\n\n    async getOccurrenceCountForSpeciesList({layerId, placeNames, speciesListId}) {\n        const url = `${CONFIG.URL_RECORDS_WS}/occurrences/search?q=${layerId}:(${encodeAndJoin(placeNames)})&facets=names_and_lsid&pageSize=1&flimit=-1\n                            &fq=-occurrence_status:absent&fq=species_list_uid:${speciesListId}&sort=year&dir=desc&fl=year`;\n\n        const json = await this._getJson(url);\n        return this._buildOccurrenceCountDTO(json)\n    }\n\n    /**\n    * @private\n    */\n    _buildSpeciesCountByGroupDTO(json) {\n        return json;\n    }\n\n    /**\n     * @private\n     */\n    _buildOccurrenceCountDTO(json) {\n        //let result = json.facetResults?.[0]?.fieldResult?.map(it => {\n        let year = json.occurrences && json.occurrences[0] && json.occurrences[0].year ? json.occurrences[0].year:0;\n        let result = json.facetResults && json.facetResults[0] && json.facetResults[0].fieldResult ?\n            json.facetResults[0].fieldResult.map(it => {\n                const label = it.label.split('|');\n                return {\n                    ...it,\n                    year,\n                    additional: {\n                        scientificName: label[0],\n                        commonName: label[2],\n                        taxonGuid: label[1]\n                    }\n                };\n            }) : [];\n\n        return result;\n    }\n\n    /** @private */\n    _getJson(url) {\n        return getJson(url)\n    }\n}","import { getJson } from '../util/index.js'\nimport { CONFIG } from '../config/index.js'\n\n/**\n* @private\n*/\nexport class ListsWS {\n\n    async getSpeciesList(speciesListId) {\n        let url = `${CONFIG.URL_LISTS_WS}/ws/speciesListItems/${speciesListId}`;\n        let json = await getJson(url);\n        return this._buildSpeciesListDTO(json);\n    }\n\n\n    /**\n    * @private\n    */\n    _buildSpeciesListDTO(json) {\n        return json;\n    }\n\n}","import { RecordsWS } from '../services/records-ws.js'\nimport { ListsWS } from '../services/lists-ws.js'\nimport {rejectInvalidRequest, ERROR_MESSAGES} from '../validation/index.js'\nimport {SPECIES_LIST} from '../config/index.js'\n\n/**\n * @classdesc Represents the NBN Places SDK. In Beta!!\n * @memberof NBNAtlas\n */\n export class Places {\n\n    /**\n     * Create a place.\n     * @param {number} layerId - The NBN layer id.\n    */\n    constructor(layerId) {\n        this.layerId = layerId;\n        this.recordsWS = new RecordsWS();\n        this.listsWS = new ListsWS();\n    }\n\n    /**\n     * Returns the species count grouped by species group.\n     * @async\n     * @example\n     * NBNAtlas.places(NBNAtlas.LAYERS.BEAUTIFUL_BURIAL_GROUNDS)\n     *                  .getSpeciesCountByGroup(['Croydon Cemetery'],\n     *                                          NBNAtlas.SPECIES_LIST.BEAUTIFUL_BURIAL_GROUNDS_SEEK_ADVICE)\n     * .then(data=>\n     *   console.log(JSON.stringify(data))\n     *  );\n     *\n     * @param {string[]} placeNames - Array of place names.\n     * @param {string} [selectedspeciesListId] - The id of a species list for which a grouped count is also returned.\n     * @return {Promise<Array<NBNAtlas.typedefs.SpeciesCountByGroup>>}\n     */\n    async getSpeciesCountByGroup(placeNames, selectedspeciesListId) {\n        if (!placeNames || !placeNames.length) {\n            return rejectInvalidRequest(ERROR_MESSAGES.MISSING_PLACE_NAME);\n        }\n       \n        const speciesCountByGroupDTO = await this.recordsWS.getSpeciesCountByGroup({layerId:this.layerId, placeNames});\n\n        let selectedSpeciesCountByGroupDTO = selectedspeciesListId ? \n            await this.recordsWS.getSpeciesCountByGroupForSpeciesList({layerId:this.layerId, placeNames, speciesListId:selectedspeciesListId}) : [];\n      \n        return this._buildSpeciesCountByGroupResult(speciesCountByGroupDTO, selectedSpeciesCountByGroupDTO);\n    }\n\n    /**\n     * Returns the occurrence counts.\n     * @example\n     * NBNAtlas.places(NBNAtlas.LAYERS.BEAUTIFUL_BURIAL_GROUNDS).getOccurrenceCount(['Argyll Biological Records Centre'])\n     * .then(data=>\n     *   console.log(JSON.stringify(data))\n     *  );\n     *\n     * @param {string[]} placeNames - Array of place names.\n     * @return {Promise<Array<NBNAtlas.typedefs.OccurrenceCount>>}\n     */\n    async getOccurrenceCount(placeNames) {\n        if (!placeNames) {\n            return rejectInvalidRequest(ERROR_MESSAGES.MISSING_PLACE_NAME);\n        }\n        \n        let result = [];\n        const occurrenceCountDTO = await this.recordsWS.getOccurrenceCount({layerId:this.layerId, placeNames});\n        if (occurrenceCountDTO) {\n            const sensitiveInWalesDTO = await this.listsWS.getSpeciesList(SPECIES_LIST.SENSITIVE_IN_WALES);\n            const sensitiveInEnglandDTO = await this.listsWS.getSpeciesList(SPECIES_LIST.SENSITIVE_IN_ENGLAND);\n\n            result = this._buildOccurrenceCountResult(occurrenceCountDTO, sensitiveInWalesDTO, sensitiveInEnglandDTO);\n        }\n\n        return result;\n    }\n\n    /**\n    * Returns the occurrence counts for a species list.\n    * @async\n    * @example\n    * NBNAtlas.places(NBNAtlas.LAYERS.BEAUTIFUL_BURIAL_GROUNDS)\n     *                  .getOccurrenceCountForSpeciesList(['Argyll Biological Records Centre'],\n     *                                                     NBNAtlas.SPECIES_LIST.BEAUTIFUL_BURIAL_GROUNDS_SEEK_ADVICE)\n     * .then(data=>\n     *   console.log(JSON.stringify(data))\n     *  );\n     *\n     * @param {string[]} placeNames - Array of place names.\n    * @param {string} speciesListId - The species list id.\n    * @return {Promise<Array<NBNAtlas.typedefs.OccurrenceCount>>}\n    */\n    async getOccurrenceCountForSpeciesList(placeNames, speciesListId) {\n        if (!placeNames) {\n            return rejectInvalidRequest(ERROR_MESSAGES.MISSING_PLACE_NAME);\n        }\n        if (!speciesListId) {\n            return rejectInvalidRequest(ERROR_MESSAGES.MISSING_SPECIES_LIST_ID);\n        }\n        const speciesListDTO = await this.listsWS.getSpeciesList(speciesListId);\n\n        let result = [];\n        const occurrenceCountDTO = await this.recordsWS.getOccurrenceCountForSpeciesList({layerId:this.layerId, placeNames, speciesListId});\n        if (occurrenceCountDTO) {\n            const sensitiveInWalesDTO = await this.listsWS.getSpeciesList(SPECIES_LIST.SENSITIVE_IN_WALES);\n            const sensitiveInEnglandDTO = await this.listsWS.getSpeciesList(SPECIES_LIST.SENSITIVE_IN_ENGLAND);\n\n            result = this._buildOccurrenceCountForSpeciesListResult(speciesListDTO, occurrenceCountDTO, sensitiveInWalesDTO, sensitiveInEnglandDTO);\n        }\n\n        return result;\n    }\n\n\n\n    /**\n     * @private\n     */\n    _buildSpeciesCountByGroupResult(speciesCountByGroupDTO, selectedSpeciesCountByGroupDTO) {\n        const map = new Map();\n\n        speciesCountByGroupDTO.forEach(it => map.set(it.name,\n            {\n                speciesGroup: it.name,\n                speciesCount: it.speciesCount,\n                selectedSpeciesCount: 0\n            }\n        ));\n\n        selectedSpeciesCountByGroupDTO.forEach(it => {\n            let val = map.get(it.name);\n\n            if (!val) {\n                map.set(it.name, {\n                    speciesGroup: it.name,\n                    speciesCount: 0,\n                    selectedSpeciesCount: it.speciesCount\n                });\n            } else {\n                val = {\n                    ...val,\n                    selectedSpeciesCount: it.speciesCount\n                };\n            }\n\n        });\n\n        return [...map.values()];\n\n    }\n\n\n    /**\n     * @private\n     */\n    _buildOccurrenceCountResult(occurrenceCountDTO, sensitiveInEnglandDTO, sensitiveInWalesDTO) {\n        if (!occurrenceCountDTO) {\n            return {}\n        }\n        const england = this._sensitiveSpeciesJSONToMap(sensitiveInEnglandDTO);\n        const wales = this._sensitiveSpeciesJSONToMap(sensitiveInWalesDTO);\n        return occurrenceCountDTO.map(it => (\n            {\n                scientificName: it.additional.scientificName,\n                commonName: it.additional.commonName,\n                taxonGuid: it.additional.taxonGuid,\n                count: it.count,\n                sensitiveInEngland: !!england[it.additional.taxonGuid],\n                sensitiveInWales: !!wales[it.additional.taxonGuid]\n            }\n        ));\n    }\n\n    /**\n     * @private\n     */\n    _buildOccurrenceCountForSpeciesListResult(speciesListDTO, occurrenceCountDTO, sensitiveInEnglandDTO, sensitiveInWalesDTO) {\n        if (!occurrenceCountDTO) {\n            return {}\n        }\n        const england = this._sensitiveSpeciesJSONToMap(sensitiveInEnglandDTO);\n        const wales = this._sensitiveSpeciesJSONToMap(sensitiveInWalesDTO);\n        return speciesListDTO.map(it => {\n            let countAndLastRecorded = this._getOccurrenceCountAndLastRecorded(it.lsid, occurrenceCountDTO);\n\n            return(\n                {\n                scientificName:it.scientificName,\n                commonName:it.commonName,\n                taxonGuid:it.lsid,\n                lastRecorded:countAndLastRecorded.lastRecorded,\n                count:countAndLastRecorded.count,\n                sensitiveInEngland:!!england[it.lsid],\n                sensitiveInWales:!!wales[it.lsid]\n                }\n            )\n        });\n    }\n\n    /**\n    * @private \n    */\n    _getOccurrenceCountAndLastRecorded(taxonGuid, occurrenceCountDTO) {\n        let result = {count:0,lastRecorded:0}\n\n        occurrenceCountDTO.some(it => {\n            if (it.additional.taxonGuid === taxonGuid) {\n                result = {\n                    count:it.count,\n                    lastRecorded:it.year\n                }\n                return true;\n            }\n            return false;\n        });\n        return result;\n    }\n\n    /**\n     * @private\n     */\n    _sensitiveSpeciesJSONToMap(json) {\n        return json.reduce((map, obj) => {\n            map[obj.lsid] = obj;\n            return map;\n        }, {});\n    }\n\n   \n\n}\n\nexport var places = function (layerId) {\n\treturn new Places(layerId);\n};\n","import { SpeciesWS } from '../services/species-ws.js'\nimport { rejectInvalidRequest, ERROR_MESSAGES } from '../validation/index.js'\nimport { SPECIES_LIST, LAYERS } from '../config/index.js'\nimport { Places } from './places.js'\n\n/**\n * @classdesc Represents the Beautiful Burial Grounds SDK.\n * @memberof NBNAtlas\n */\nexport class BBG {\n\n    constructor() {\n        this.places = new Places(LAYERS.BEAUTIFUL_BURIAL_GROUNDS)\n        this.speciesWS = new SpeciesWS();\n    }\n\n    /**\n     * @description Returns the seek advice data.\n     * @async\n     * @example\n     * NBNAtlas.bbg.getSeekAdviceData('Croydon Cemetery')\n     * .then(data=>\n     *   console.log(JSON.stringify(data))\n     *  );\n     * \n     * @param {string} placeName - The unique name of the place\n     * @return {Promise<Array<NBNAtlas.OccurrenceCount>>}\n     *   \n     */\n    async getSeekAdviceData(placeName) {\n        if (!placeName) {\n            return rejectInvalidRequest(ERROR_MESSAGES.MISSING_PLACE_NAME);\n        }\n        return this.places.getOccurrenceCountForSpeciesList([placeName], SPECIES_LIST.BEAUTIFUL_BURIAL_GROUNDS_SEEK_ADVICE)\n    }\n\n    /**\n     * @description Returns the seek advice data.\n     * @async\n     * @example\n     * NBNAtlas.bbg.getSeekAdviceDataForAssetID('615214')\n     * .then(data=>\n     *   console.log(JSON.stringify(data))\n     * );\n     *\n     * @param {string} assetID\n     * @return {Promise<Array<NBNAtlas.OccurrenceCount>>}\n     *\n     */\n    async getSeekAdviceDataForAssetID(assetID) {\n        if (!assetID) {\n            return rejectInvalidRequest(ERROR_MESSAGES.MISSING_ASSET_ID);\n        }\n        let asset = await this.speciesWS.getBBGPlacesForAssetID(assetID);\n        return this.places.getOccurrenceCountForSpeciesList(asset.places, SPECIES_LIST.BEAUTIFUL_BURIAL_GROUNDS_SEEK_ADVICE);\n    }\n\n    /**\n     * @description Returns the digest table data.\n     * @async\n     * @example\n     * NBNAtlas.bbg.getDigestTableData('Croydon Cemetery')\n     * .then(data=>\n     *   console.log(JSON.stringify(data))\n     *  );\n     *\n     * @param {string} placeName - The unique name of the place\n     * @return {Promise<Array<NBNAtlas.SpeciesCountByGroup>>}\n    */\n    async getDigestTableData(placeName) {\n        if (!placeName) {\n            return rejectInvalidRequest(ERROR_MESSAGES.MISSING_PLACE_NAME);\n        }\n        return this.places.getSpeciesCountByGroup([placeName], SPECIES_LIST.BEAUTIFUL_BURIAL_GROUNDS_DIGEST_TABLE)\n    }\n\n    /**\n     * @description Returns the digest table data.\n     * @async\n     * @example\n     * NBNAtlas.bbg.getDigestTableDataForAssetID('615214')\n     * .then(data=>\n     *   console.log(JSON.stringify(data))\n     *  );\n     *\n     * @param {string} assetID\n     * @return {Promise<Array<NBNAtlas.SpeciesCountByGroup>>}\n     */\n    async getDigestTableDataForAssetID(assetID) {\n        if (!assetID) {\n            return rejectInvalidRequest(ERROR_MESSAGES.MISSING_ASSET_ID);\n        }\n        let asset = await this.speciesWS.getBBGPlacesForAssetID(assetID);\n        return this.places.getSpeciesCountByGroup(asset.places, SPECIES_LIST.BEAUTIFUL_BURIAL_GROUNDS_DIGEST_TABLE)\n    }\n\n    /**\n     * @description Returns a BBG site or place.\n     * @async\n     * @example\n     * NBNAtlas.bbg.getPlace('Baildon: St James')\n     * .then(data=>\n     *   console.log(JSON.stringify(data))\n     *  );\n     *\n     * @param {string} placeName - The unique name of the place\n     * @return {Promise<NBNAtlas.BBGPlace>}\n    */\n    async getPlace(placeName) {\n        if (!placeName) {\n            return rejectInvalidRequest(ERROR_MESSAGES.MISSING_PLACE_NAME);\n        }\n        return this.speciesWS.getBBGPlace(placeName);\n    }\n\n}\n\n\nexport const bbg = new BBG();"],"names":["async","getJson","url","controller","AbortController","setTimeout","abort","response","fetch","signal","status","Promise","reject","message","statusText","body","data","json","encodeAndJoin","items","separator","map","it","encodeURIComponent","join","CONFIG","URL_RECORDS_WS","URL_SPECIES_WS","URL_LISTS_WS","LAYERS","BEAUTIFUL_BURIAL_GROUNDS","SPECIES_LIST","BEAUTIFUL_BURIAL_GROUNDS_SEEK_ADVICE","BEAUTIFUL_BURIAL_GROUNDS_DIGEST_TABLE","SENSITIVE_IN_ENGLAND","SENSITIVE_IN_WALES","SpeciesWS","placeName","this","_buildGetPlaceUrl","_getJson","_buildBBGPlaceDTO","assetID","_buildBBGAssetDTO","result","searchResults","results","assetid_s","name","bbg_name_s","length","assetName","name_s","places","ERROR_MESSAGES","rejectInvalidRequest","RecordsWS","layerId","placeNames","_buildSpeciesCountByGroupDTO","speciesListId","_buildOccurrenceCountDTO","year","occurrences","facetResults","fieldResult","label","split","additional","scientificName","commonName","taxonGuid","ListsWS","_buildSpeciesListDTO","Places","constructor","recordsWS","listsWS","selectedspeciesListId","speciesCountByGroupDTO","getSpeciesCountByGroup","selectedSpeciesCountByGroupDTO","getSpeciesCountByGroupForSpeciesList","_buildSpeciesCountByGroupResult","occurrenceCountDTO","getOccurrenceCount","sensitiveInWalesDTO","getSpeciesList","sensitiveInEnglandDTO","_buildOccurrenceCountResult","speciesListDTO","getOccurrenceCountForSpeciesList","_buildOccurrenceCountForSpeciesListResult","Map","forEach","set","speciesGroup","speciesCount","selectedSpeciesCount","val","get","values","england","_sensitiveSpeciesJSONToMap","wales","count","sensitiveInEngland","sensitiveInWales","countAndLastRecorded","_getOccurrenceCountAndLastRecorded","lsid","lastRecorded","some","reduce","obj","BBG","speciesWS","asset","getBBGPlacesForAssetID","getBBGPlace","bbg"],"mappings":"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"}